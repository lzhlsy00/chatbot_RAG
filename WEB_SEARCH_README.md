# 联网搜索功能说明

## 功能概述

本应用现在支持智能联网搜索功能，当知识库中的内容不足以回答问题时，系统会自动进行网络搜索来补充信息，并在回答末尾标记所有来源。

## 功能特点

1. **智能判断**: 系统会自动判断何时需要联网搜索
2. **来源标记**: 区分知识库来源(📚)和网络搜索来源(🌐)
3. **无缝集成**: 用户无需任何额外操作，系统自动处理

## 触发条件

系统会在以下情况下自动进行联网搜索：

### 1. 知识库内容不足
- 没有找到相关的知识库内容
- 知识库检索结果太少（少于2条）

### 2. 时效性查询
包含以下关键词的查询会触发联网搜索：
- 中文: 最新、今年、2024、2025、最近、现在、当前、目前
- 英文: latest、current、recent

### 3. 实时性查询  
包含以下关键词的查询会触发联网搜索：
- 中文: 新闻、股价、天气、汇率、价格
- 英文: news、weather、price

## 配置方法

### 1. 获取 Google Search API 密钥
1. 访问 [Google Cloud Console](https://console.cloud.google.com/)
2. 创建新项目或选择现有项目
3. 启用 "Custom Search API"
4. 在"凭据"页面创建 API 密钥

### 2. 创建自定义搜索引擎
1. 访问 [Google Custom Search](https://cse.google.com/)
2. 创建新的搜索引擎
3. 配置搜索范围（可以设置为搜索整个网络）
4. 获取搜索引擎 ID

### 3. 配置环境变量
在 `.env.local` 文件中添加：
```env
# Google Search API Configuration (Optional - for web search fallback)
GOOGLE_SEARCH_API_KEY=your_google_search_api_key_here
GOOGLE_SEARCH_ENGINE_ID=your_google_search_engine_id_here
```

## 使用示例

### 触发联网搜索的查询示例：
- "2024年最新的AI技术发展趋势"
- "今日股市行情如何？"
- "最近有什么重要的科技新闻？" 
- "当前的汇率是多少？"

### 响应示例：
```
根据最新信息，2024年AI技术在以下几个方面有重要发展...

*注：为了提供更全面的信息，已补充相关网络搜索结果。*

**参考来源：**
[1] 📚 AI技术发展报告.pdf
[2] 🌐 2024年人工智能发展趋势分析 - 科技日报
[3] 🌐 最新AI技术突破盘点 - 机器之心
```

## 技术实现

### 核心组件
- `WebSearchClient`: 处理网络搜索请求
- `CozeStreamClient`: 集成知识库检索和网络搜索
- 智能判断逻辑: 决定何时进行联网搜索

### 搜索流程
1. 用户提问
2. 系统进行知识库检索
3. 评估知识库结果是否充分
4. 如需要，执行网络搜索
5. 整合所有来源，统一展示

## 注意事项

1. **API 费用**: Google Search API 有使用限制和费用，请根据需要配置
2. **可选功能**: 如未配置搜索 API，系统仍可正常工作，只是不会进行联网搜索
3. **搜索质量**: 网络搜索结果的质量取决于搜索关键词和搜索引擎配置
4. **隐私**: 网络搜索会向 Google 发送查询内容，请注意隐私政策

## 故障排除

### 常见问题：
1. **搜索不生效**: 检查 API 密钥和搜索引擎 ID 配置
2. **API 配额超限**: 检查 Google Cloud 控制台的配额使用情况
3. **搜索结果不相关**: 优化搜索引擎配置或调整搜索关键词